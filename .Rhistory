axis.title = element_blank(),
legend.background = element_blank(),
legend.title = element_text(size = 10),
legend.text = element_text(size = 10),
legend.key = element_blank(),
legend.position = "bottom",
legend.direction = "horizontal")
#add a picture of P. astreoides
pastPic = image_read("C:/Users/erin_/Documents/GitHub/SEFL_Pastreoides_2bRAD/data_files/past.png") %>%
image_border("black", "10x10")
seflMap = ggdraw() +
draw_plot(siteMap) +
draw_plot(floridaMap, x = 0.63, y = 0.655, width = 0.35, height = 0.35) +
draw_image(pastPic, x = 0.63, y = 0.21, width = 0.336, height = 0.336)
# seflMap
ggsave("C:/Users/erin_/Documents/GitHub/SEFL_Pastreoides_2bRAD/figures/pastMap.png", plot = seflMap, width = 12, height = 13, units = "cm", dpi = 300)
ggsave("C:/Users/erin_/Documents/GitHub/SEFL_Pastreoides_2bRAD/figures/pastMap.tiff", plot = seflMap, width = 12, height = 13, units = "cm", dpi = 300)
ggsave("C:/Users/erin_/Documents/GitHub/SEFL_Pastreoides_2bRAD/figures/pastMap.eps", plot = seflMap, width = 12, height = 13, units = "cm", dpi = 300)
paletteer_d("khroma::iridescent", type=c("discrete"))
paletteer_d(`"nbapalettes::suns_retro"`, type=c("discrete"))
paletteer_d("MapPalettes::sunset", type=c("discrete"))
paletteer_d("rcartocolor::SunsetDark", type=c("discrete"))
paletteer_d("vapoRwave::newRetro", type=c("discrete"))
paletteer_d("vapoRwave::sunSet", type=c("discrete"))
paletteer_d("RSkittleBrewer::tropical", type=c("discrete"))
#packages: magick, cowplot
#choose your colors
#paletteer_d("LaCroixColoR::PeachPear", type = c("discrete"))
#flPal = paletteer_d("LaCroixColoR::PeachPear")[c(1,2,3,4,5)]
#flPal = paletteer_d("LaCroixColoR::paired")[c(11,12,8,4,3)]
#flPal= paletteer_d("LaCroixColoR::paired")[c(2,12,8,4,11)]
#flPal= paletteer_d("LaCroixColoR::paired")[c(2,5,8,4,11)]
flPal = paletteer_d("RSkittleBrewer::tropical")[c(3,1,5,4,2)]
#erins <- palette(c(erins,"#EFC7E6FF", "#B25D91FF", "#FC6882FF", "#EFEF46FF", "#8FDA04FF"))
latLab = paste(format(abs(seq(26, 27.2, by = 0.2)), nsmall = 1), "ºN", sep = "")
longLab = paste(format(abs(seq(-80.6, -79.2, by = 0.2)), nsmall = 1), "ºW", sep = "")
siteMap = ggplot() +
geom_sf(data = florida, fill = "white", color = "gray40", size = 0.25) +
geom_sf(data = countries, fill = "white", color = "gray40", size = 0.25) +
geom_sf(data = frt, fill = "gray80", size = 0) +
geom_point(data = popLabs, aes(x = longDD, y = latDD, fill = region), shape = 21, size = 4) +
geom_sf_text(data = countyNames, aes(label = ID), nudge_x = c(0.1, 0, 0.1),
nudge_y = c(0, -.025, -0.1)) +
scale_fill_manual(values = flPal, name = "Population:") +
coord_sf(xlim = c(-80.6, -79.2), ylim = c(26, 27.2)) +
scale_x_continuous(breaks = c(seq(-80.6, -79.2, by = 0.2)), labels = longLab) +
scale_y_continuous(breaks = c(seq(26, 27.2, by = 0.2)), labels = latLab) +
annotation_scale(location = "br") +
guides(fill = guide_legend(ncol = 3)) +
theme_bw() +
theme(panel.background = element_rect(fill = "aliceblue"),
panel.border = element_rect(color = "black", size = 0.75, fill = NA),
plot.background = element_blank(),
axis.ticks = element_line(color = "black"),
axis.text = element_text(color = "black"),
axis.title = element_blank(),
legend.background = element_blank(),
legend.title = element_text(size = 10),
legend.text = element_text(size = 10),
legend.key = element_blank(),
legend.position = "bottom",
legend.direction = "horizontal")
#add a picture of P. astreoides
pastPic = image_read("C:/Users/erin_/Documents/GitHub/SEFL_Pastreoides_2bRAD/data_files/past.png") %>%
image_border("black", "10x10")
seflMap = ggdraw() +
draw_plot(siteMap) +
draw_plot(floridaMap, x = 0.63, y = 0.655, width = 0.35, height = 0.35) +
draw_image(pastPic, x = 0.63, y = 0.21, width = 0.336, height = 0.336)
# seflMap
ggsave("C:/Users/erin_/Documents/GitHub/SEFL_Pastreoides_2bRAD/figures/pastMap.png", plot = seflMap, width = 12, height = 13, units = "cm", dpi = 300)
ggsave("C:/Users/erin_/Documents/GitHub/SEFL_Pastreoides_2bRAD/figures/pastMap.tiff", plot = seflMap, width = 12, height = 13, units = "cm", dpi = 300)
ggsave("C:/Users/erin_/Documents/GitHub/SEFL_Pastreoides_2bRAD/figures/pastMap.eps", plot = seflMap, width = 12, height = 13, units = "cm", dpi = 300)
paletteer_d("RSkittleBrewer::smarties", type=c("discrete"))
#packages: magick, cowplot
#choose your colors
#paletteer_d("LaCroixColoR::PeachPear", type = c("discrete"))
#flPal = paletteer_d("LaCroixColoR::PeachPear")[c(1,2,3,4,5)]
#flPal = paletteer_d("LaCroixColoR::paired")[c(11,12,8,4,3)]
#flPal= paletteer_d("LaCroixColoR::paired")[c(2,12,8,4,11)]
#flPal= paletteer_d("LaCroixColoR::paired")[c(2,5,8,4,11)]
#flPal = paletteer_d("RSkittleBrewer::tropical")[c(3,1,5,4,2)]
flPal = paletteer_d("RSkittleBrewer::smarties")[c(1,2,3,4,5)]
#erins <- palette(c(erins,"#EFC7E6FF", "#B25D91FF", "#FC6882FF", "#EFEF46FF", "#8FDA04FF"))
latLab = paste(format(abs(seq(26, 27.2, by = 0.2)), nsmall = 1), "ºN", sep = "")
longLab = paste(format(abs(seq(-80.6, -79.2, by = 0.2)), nsmall = 1), "ºW", sep = "")
siteMap = ggplot() +
geom_sf(data = florida, fill = "white", color = "gray40", size = 0.25) +
geom_sf(data = countries, fill = "white", color = "gray40", size = 0.25) +
geom_sf(data = frt, fill = "gray80", size = 0) +
geom_point(data = popLabs, aes(x = longDD, y = latDD, fill = region), shape = 21, size = 4) +
geom_sf_text(data = countyNames, aes(label = ID), nudge_x = c(0.1, 0, 0.1),
nudge_y = c(0, -.025, -0.1)) +
scale_fill_manual(values = flPal, name = "Population:") +
coord_sf(xlim = c(-80.6, -79.2), ylim = c(26, 27.2)) +
scale_x_continuous(breaks = c(seq(-80.6, -79.2, by = 0.2)), labels = longLab) +
scale_y_continuous(breaks = c(seq(26, 27.2, by = 0.2)), labels = latLab) +
annotation_scale(location = "br") +
guides(fill = guide_legend(ncol = 3)) +
theme_bw() +
theme(panel.background = element_rect(fill = "aliceblue"),
panel.border = element_rect(color = "black", size = 0.75, fill = NA),
plot.background = element_blank(),
axis.ticks = element_line(color = "black"),
axis.text = element_text(color = "black"),
axis.title = element_blank(),
legend.background = element_blank(),
legend.title = element_text(size = 10),
legend.text = element_text(size = 10),
legend.key = element_blank(),
legend.position = "bottom",
legend.direction = "horizontal")
#add a picture of P. astreoides
pastPic = image_read("C:/Users/erin_/Documents/GitHub/SEFL_Pastreoides_2bRAD/data_files/past.png") %>%
image_border("black", "10x10")
seflMap = ggdraw() +
draw_plot(siteMap) +
draw_plot(floridaMap, x = 0.63, y = 0.655, width = 0.35, height = 0.35) +
draw_image(pastPic, x = 0.63, y = 0.21, width = 0.336, height = 0.336)
# seflMap
ggsave("C:/Users/erin_/Documents/GitHub/SEFL_Pastreoides_2bRAD/figures/pastMap.png", plot = seflMap, width = 12, height = 13, units = "cm", dpi = 300)
ggsave("C:/Users/erin_/Documents/GitHub/SEFL_Pastreoides_2bRAD/figures/pastMap.tiff", plot = seflMap, width = 12, height = 13, units = "cm", dpi = 300)
ggsave("C:/Users/erin_/Documents/GitHub/SEFL_Pastreoides_2bRAD/figures/pastMap.eps", plot = seflMap, width = 12, height = 13, units = "cm", dpi = 300)
paletteer_d("RSkittleBrewer::smarties", type=c("discrete"))
#packages: magick, cowplot
#choose your colors
#paletteer_d("LaCroixColoR::PeachPear", type = c("discrete"))
#flPal = paletteer_d("LaCroixColoR::PeachPear")[c(1,2,3,4,5)]
#flPal = paletteer_d("LaCroixColoR::paired")[c(11,12,8,4,3)]
#flPal= paletteer_d("LaCroixColoR::paired")[c(2,12,8,4,11)]
#flPal= paletteer_d("LaCroixColoR::paired")[c(2,5,8,4,11)]
#flPal = paletteer_d("RSkittleBrewer::tropical")[c(3,1,5,4,2)]
flPal = paletteer_d("RSkittleBrewer::smarties")[c(1,3,4,5,6)]
#erins <- palette(c(erins,"#EFC7E6FF", "#B25D91FF", "#FC6882FF", "#EFEF46FF", "#8FDA04FF"))
latLab = paste(format(abs(seq(26, 27.2, by = 0.2)), nsmall = 1), "ºN", sep = "")
longLab = paste(format(abs(seq(-80.6, -79.2, by = 0.2)), nsmall = 1), "ºW", sep = "")
siteMap = ggplot() +
geom_sf(data = florida, fill = "white", color = "gray40", size = 0.25) +
geom_sf(data = countries, fill = "white", color = "gray40", size = 0.25) +
geom_sf(data = frt, fill = "gray80", size = 0) +
geom_point(data = popLabs, aes(x = longDD, y = latDD, fill = region), shape = 21, size = 4) +
geom_sf_text(data = countyNames, aes(label = ID), nudge_x = c(0.1, 0, 0.1),
nudge_y = c(0, -.025, -0.1)) +
scale_fill_manual(values = flPal, name = "Population:") +
coord_sf(xlim = c(-80.6, -79.2), ylim = c(26, 27.2)) +
scale_x_continuous(breaks = c(seq(-80.6, -79.2, by = 0.2)), labels = longLab) +
scale_y_continuous(breaks = c(seq(26, 27.2, by = 0.2)), labels = latLab) +
annotation_scale(location = "br") +
guides(fill = guide_legend(ncol = 3)) +
theme_bw() +
theme(panel.background = element_rect(fill = "aliceblue"),
panel.border = element_rect(color = "black", size = 0.75, fill = NA),
plot.background = element_blank(),
axis.ticks = element_line(color = "black"),
axis.text = element_text(color = "black"),
axis.title = element_blank(),
legend.background = element_blank(),
legend.title = element_text(size = 10),
legend.text = element_text(size = 10),
legend.key = element_blank(),
legend.position = "bottom",
legend.direction = "horizontal")
#add a picture of P. astreoides
pastPic = image_read("C:/Users/erin_/Documents/GitHub/SEFL_Pastreoides_2bRAD/data_files/past.png") %>%
image_border("black", "10x10")
seflMap = ggdraw() +
draw_plot(siteMap) +
draw_plot(floridaMap, x = 0.63, y = 0.655, width = 0.35, height = 0.35) +
draw_image(pastPic, x = 0.63, y = 0.21, width = 0.336, height = 0.336)
# seflMap
ggsave("C:/Users/erin_/Documents/GitHub/SEFL_Pastreoides_2bRAD/figures/pastMap.png", plot = seflMap, width = 12, height = 13, units = "cm", dpi = 300)
ggsave("C:/Users/erin_/Documents/GitHub/SEFL_Pastreoides_2bRAD/figures/pastMap.tiff", plot = seflMap, width = 12, height = 13, units = "cm", dpi = 300)
ggsave("C:/Users/erin_/Documents/GitHub/SEFL_Pastreoides_2bRAD/figures/pastMap.eps", plot = seflMap, width = 12, height = 13, units = "cm", dpi = 300)
paletteer_d("rcartocolor::Pastel", type=c("discrete"))
paletteer_d("rcartocolor::Prism", type=c("discrete"))
paletteer_d("LaCroixColoR::PeachPear", type = c("discrete"))
# packages: tidyverse, paletteer, vegan if use vectors
#calculating depth & latitude vectors
pastMa = as.matrix(read.table("C:/Users/erin_/Documents/GitHub/SEFL_Pastreoides_2bRAD/data_files/pastNoClones.ibsMat"))
pastMds = cmdscale(pastMa, eig = TRUE, x.ret = TRUE)
meta = read.csv("C:/Users/erin_/Documents/GitHub/SEFL_Pastreoides_2bRAD/data_files/poritesastreoidesMetaData_clonesremoved.csv")
env=dplyr::select(meta, collection_depth_m, site_lat)
#env=cbind(env,envData)
envDrivers=envfit(pastMds, env, permutations = 999)
envDriversScores <- as.data.frame(scores(envDrivers, display = "vectors"))
#extracts relevant scores from envifit
A <- as.list(envDrivers$vectors)
pvals<-as.data.frame(A$pvals)
arrows<-as.data.frame(A$arrows*sqrt(A$r))
C<-cbind(arrows, pvals)
#                         Dim1        Dim2 A$pvals
#collection_depth_m -0.5893338 -0.02474275   0.004
#site_lat           -0.5456895  0.20714215   0.004
#$r
#collection_depth_m           site_lat
#         0.3479266          0.3406849
#Cred<-subset(C,pvals<0.01) #Filters species with highly significant loadings
Cred <- cbind(C, Drivers = rownames(C))
Cred$Drivers <- as.character(Cred$Drivers)
Cred["popDepth", "Drivers"] <- "Depth"
Cred["lat", "Drivers"] <- "Latitude"
#remove from here if keep vectors
#pastMa = as.matrix(read.table("C:/Users/erin_/Documents/GitHub/SEFL_Pastreoides_2bRAD/data_files/pastNoClones.ibsMat"))
#pastMds = cmdscale(pastMa, eig = TRUE, x.ret = TRUE)
# Determine percent variation captured on each axis
# Calculate the eigenvalues so later we can figure out % variation shown on each Principal Coordinate
pastPcoaVar = round(pastMds$eig/sum(pastMds$eig)*100, 1)
head(pastPcoaVar)
# Format data to plot
pastPcoaValues = pastMds$points
head(pastPcoaValues)
# 2-column tab-delimited table of individual assignments to populations; must be in the same order as samples in the bam list or vcf file.
pastI2P = read.csv("C:/Users/erin_/Documents/GitHub/SEFL_Pastreoides_2bRAD/data_files/poritesastreoidesMetaData_clonesremoved.csv") %>% select("sample" = tube_id, "pop" = region)
pastI2P$pop[pastI2P$pop=="Pompano/LBTS"]<-"Ft. Lauderdale"
row.names(pastI2P) = pastI2P[,1]
pastPcoaValues=cbind(pastI2P, pastPcoaValues)
pastPcoaValues =as.data.frame(pastPcoaValues, sample = rownames(pastPcoaValues))
colnames(pastPcoaValues)[c(3,4)] = c("PCo1", "PCo2")
head(pastPcoaValues)
pastPCoA = merge(pastPcoaValues, aggregate(cbind(mean.x=PCo1,mean.y=PCo2)~pop, pastPcoaValues, mean), by="pop")
pastPCoA$pop = factor(pastPCoA$pop)
levels(pastPCoA$pop)
pastPCoA$pop = factor(pastPCoA$pop, levels(pastPCoA$pop)[c(4, 3, 5, 1, 2)])
flPal = paletteer_d("LaCroixColoR::PeachPear")[c(1,2,3,4,5)]
#flPal = paletteer_d("LaCroixColoR::paired")[c(11,12,8,4,3)]
#flPal = paletteer_d("rcartocolor::Sunset")[c(7, 6, 4, 3, 1)]
pastPcoaPlotA = ggplot(pastPCoA, aes(x = PCo1, y = PCo2, color = pop, fill = pop)) +
geom_segment(data = Cred, aes(x = 0, xend = Dim1*0.348, y = 0,
yend = Dim2*0.28), arrow = arrow(length = unit(0.4, "cm")), color = "black", size=1, inherit.aes = FALSE) + # adds vectors
geom_text(data = Cred, aes(x = Dim1*0.348, y = ((Dim2*0.28)-0.02), label = Drivers), size = 2, inherit.aes = FALSE)+ # adds labels to vectors
geom_hline(yintercept = 0, color = "gray90", size = 0.5) +
geom_vline(xintercept = 0, color = "gray90", size = 0.5) +
#ellipses
stat_ellipse(data = pastPCoA, type = "t", geom = "polygon", alpha = 0.1) +
#individuals indicated by small transparent circles
geom_point(aes(x = PCo1, y = PCo2), size = 3, alpha = 0.3, show.legend = FALSE) +
#population centroids indicated by large circles
geom_point(aes(x = mean.x, y = mean.y), size = 5, color = "black", shape = 21) +
annotate(geom = "text", x = 0.1, y = -0.25, label = bquote("AMOVA:"~.(amovaPerc)*","~italic(p)~" = "~.(amovaP))) +
scale_fill_manual(values = flPal, name = "Region") +
scale_color_manual(values = flPal, guide = NULL) +
xlab(paste ("PCo 1 (", pastPcoaVar[1],"%)", sep = "")) + #Prints percent variation explained by first axis
ylab(paste ("PCo 2 (", pastPcoaVar[2],"%)", sep = "")) + #Prints percent variation explained by second axis
guides(shape = guide_legend(order = 2), linetype = guide_legend(override.aes = list(linetype = c(1,2), alpha = 1, color = "black", fill = NA), order = 3), fill = guide_legend(override.aes = list(shape = 22, size = 5, color = NA, alpha = NA), order = 1))+
theme_bw()
pastPcoaPlot = pastPcoaPlotA +
theme(axis.title.x = element_text(color = "black", size = 10),
axis.text.x = element_blank(),
axis.ticks.x = element_blank(),
axis.line.x = element_blank(),
axis.title.y = element_text(color = "black", size = 10),
axis.text.y = element_blank(),
axis.ticks.y = element_blank(),
axis.line.y = element_blank(),
legend.position = "right",
panel.border = element_rect(color = "black", size = 1),
panel.background = element_rect(fill = "white"),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank())
pastPcoaPlot
ggsave("C:/Users/erin_/Documents/GitHub/SEFL_Pastreoides_2bRAD/figures/pcoaPlot.png", plot = pastPcoaPlot, height = 3.5, width = 7, units = "in", dpi = 300)
ggsave("C:/Users/erin_/Documents/GitHub/SEFL_Pastreoides_2bRAD/figures/pcoaPlot.pdf", plot = pastPcoaPlot, height = 3.5, width = 7, units = "in", dpi = 300)
ggsave("C:/Users/erin_/Documents/GitHub/SEFL_Pastreoides_2bRAD/figures/pcoaPlot.tiff", plot = pastPcoaPlot, height = 3.5, width = 7, units = "in", dpi = 300)
#packages: paletteer, reshape2, patchwork
hetMelt = melt(het, id.vars = c("sample", "Region"), variable.name = "type", value.name = "heterozygosity")
# packages: tidyverse, rstatix
#rstatix package for Tukey post hoc
#Read in population data
popData = read.csv("C:/Users/erin_/Documents/GitHub/SEFL_Pastreoides_2bRAD/data_files/poritesastreoidesMetaData_clonesremoved.csv") %>% select("sample" = tube_id, "Region" = region)
popData$Region[popData$Region=="Pompano/LBTS"]<-"Ft. Lauderdale"
popData$a = c(0:35)
popData$Region = factor(popData$Region)
levels(popData$Region)
popData$Region = factor(popData$Region, levels = levels(popData$Region)[c(4, 3, 5, 1, 2)])
hetAll = read.table("C:/Users/erin_/Documents/GitHub/SEFL_Pastreoides_2bRAD/data_files/hetAllSites")
colnames(hetAll) = c("sample", "All")
hetAll$sample = popData$sample
HetSNPs = read.table("C:/Users/erin_/Documents/GitHub/SEFL_Pastreoides_2bRAD/data_files/HetSNPs")
colnames(HetSNPs) = c("sample", "SNPs")
HetSNPs$sample = popData$sample
pastBreed = read.delim("C:/Users/erin_/Documents/GitHub/SEFL_Pastreoides_2bRAD/data_files/newres")
pastBreed2 = pastBreed %>% group_by(a) %>% select("inbreed" = Fa)
pastBreed3 = pastBreed %>% group_by(b) %>% select("inbreed" = Fb)
pastBreed = bind_rows(pastBreed2, pastBreed3) %>% group_by(a) %>% summarize("inbreed" = mean(inbreed))
pastRelate = read.delim("C:/Users/erin_/Documents/GitHub/SEFL_Pastreoides_2bRAD/data_files/newres")
pastRelate2 = pastRelate %>% group_by(a, b) %>% select("relate" = rab)
pastRelate2 = pastRelate2 %>% left_join(popData, by = "a") %>% left_join(popData, by = c("b" = "a"), suffix = c(".a", ".b"))
pastRelate = pastRelate2 %>% filter(Region.a == Region.b) %>% rename(Region = Region.a)
het = left_join(popData, hetAll, by = "sample") %>% left_join(HetSNPs, by = "sample") %>% mutate("inbreed" = pastBreed$inbreed)
hetStats = het %>% group_by(Region) %>% dplyr::summarise(N = n(), meanAll = mean(All), sdAll = sd(All), seAll = sd(All)/sqrt(N), meanSnps = mean(SNPs), sdSnps = sd(SNPs), seSnps = sd(SNPs)/sqrt(N), meanInbreed = mean(inbreed), sdInbreed = sd(inbreed), seInbreed = sd(inbreed)/sqrt(N))
min(hetStats$meanAll, na.rm = TRUE)
max(hetStats$meanAll, na.rm = TRUE)
min(hetStats$meanSnps, na.rm = TRUE)
max(hetStats$meanSnps, na.rm = TRUE)
hetAllLm = lm(data = het, All~Region)
hetSnpLm = lm(data = het, SNPs~Region)
inbreedLm = lm(data = het, inbreed~Region)
relateLm = lm(data = pastRelate, relate~Region)
#summarizing outputs from lm
hetAllANOVA = summary(aov(hetAllLm))
hetAllANOVA
hetAllpwc <- het %>% tukey_hsd(All~Region)
hetAllpwc
hetSnpANOVA = summary(aov(hetSnpLm))
hetSnpANOVA
hetSnppwc <- het %>% tukey_hsd(SNPs~Region)
hetSnppwc
inbreedANOVA = summary(aov(inbreedLm))
inbreedANOVA
inbreedpwc <- het %>% tukey_hsd(inbreed~Region)
inbreedpwc
relateANOVA = summary(aov(relateLm))
relateANOVA
relatepwc<- aov(relate ~ Region, data = pastRelate) %>% tukey_hsd()
relatepwc
hetTab = hetStats
#packages: paletteer, reshape2, patchwork
hetMelt = melt(het, id.vars = c("sample", "Region"), variable.name = "type", value.name = "heterozygosity")
flPal = paletteer_d("LaCroixColoR::PeachPear")[c(1,2,3,4,5)]
#flPal = paletteer_d("rcartocolor::Sunset")[c(7, 6, 4, 3, 1)]
hetTheme = theme(axis.title.x = element_text(color = "black", size = 12),
axis.text.x = element_blank(),
axis.ticks.x = element_blank(),
axis.title.y = element_text(color = "black", size = 12),
axis.text.y = element_text(color = "black", size = 10),
axis.ticks.y = element_line(color = "black"),
legend.position = "right",
legend.key.size = unit(0.5, 'cm'),
panel.border = element_rect(color = "black"),
panel.background = element_rect(fill = "white"),
plot.background = element_rect(fill = "white"),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank())
dodge <- position_dodge(width = 1)
hetPlotAll = ggplot(data = subset(hetMelt, subset = hetMelt$type == "All"),aes(x = Region, y = heterozygosity, fill = Region)) +
geom_point(aes(color = Region),shape = 21, position = position_jitterdodge(seed = 1, dodge.width = 1), size = 2, alpha = 0.7) +
geom_boxplot(size = 0.5, alpha = 0.7, position = dodge, color = "gray35", outlier.shape = NA) +
xlab("Region") +
ylab("Heterozygosity") +
ggtitle("All loci") +
scale_fill_manual(values = flPal) +
scale_color_manual(values = flPal) +
theme_bw() +
hetTheme
hetPlotSnps = ggplot(data = subset(hetMelt, subset = hetMelt$type == "SNPs"),aes(x = Region, y = heterozygosity, fill = Region)) +
geom_point(aes(color = Region),shape = 21, position = position_jitterdodge(seed = 1, dodge.width = 1), size = 2, alpha = 0.7) +
geom_boxplot(size = 0.5, alpha = 0.7, position = dodge, color = "gray35", outlier.shape = NA) +
xlab("Region") +
ylab("Heterozygosity") +
ggtitle("SNPs") +
scale_fill_manual(values = flPal) +
scale_color_manual(values = flPal) +
theme_bw() +
hetTheme
inbreedingPlot = ggplot(data = het, aes(x = Region, y = inbreed, fill = Region)) +
geom_point(aes(color = Region),shape = 21, position = position_jitterdodge(seed = 1, dodge.width = 1), size = 2, alpha = 0.7) +
geom_boxplot(size = 0.5, alpha = 0.7, position = dodge, color = "gray35", outlier.shape = NA) +
xlab("Region") +
ylab("Inbreeding coefficient") +
ggtitle("Inbreeding") +
scale_fill_manual(values = flPal) +
scale_color_manual(values = flPal) +
theme_bw() +
hetTheme
relatePlot = ggplot(data = pastRelate, aes(x = Region, y = relate, fill = Region)) +
geom_point(aes(color = Region),shape = 21, position = position_jitterdodge(seed = 1, dodge.width = 1), size = 2, alpha = 0.7) +
geom_boxplot(size = 0.5, alpha = 0.7, position = dodge, color = "gray35", outlier.shape = NA) +
xlab("Region") +
ylab("Relatedness") +
ggtitle("Relatedness") +
scale_fill_manual(values = flPal) +
scale_color_manual(values = flPal) +
theme_bw() +
hetTheme
hetPlots = ((hetPlotAll | hetPlotSnps) / (inbreedingPlot | relatePlot)) +
plot_annotation(tag_levels = 'A') +
plot_layout(guides = "collect")&
theme(plot.tag = element_text(size = 16),
legend.title = element_text(size = 12),
legend.text = element_text(size = 10),
legend.position = "right")
hetPlots
ggsave("figures/heterozygosityPlot.png", plot = hetPlots, width = 22, height = 16, units = "cm", dpi = 300)
ggsave("figures/heterozygosityPlot.pdf", plot = hetPlots, width = 22, height = 16, units = "cm", dpi = 300)
#packages: tidyverse, vcfR, adegenet, StAMPP, gdata, reshape2, paletteer
pastVcf = read.vcfR("C:/Users/erin_/Documents/GitHub/SEFL_Pastreoides_2bRAD/data_files/pastNoClones.bcf", verbose = FALSE)
pastGenlightPopulation = vcfR2genlight(pastVcf, n.cores = 1)
locNames(pastGenlightPopulation) = paste(pastVcf@fix[,1],pastVcf@fix[,2],sep="_")
popData = read.csv("C:/Users/erin_/Documents/GitHub/SEFL_Pastreoides_2bRAD/data_files/poritesastreoidesMetaData_clonesremoved.csv") %>% select("sample" = tube_id, "pop" = region)
strata(pastGenlightPopulation) = data.frame(popData)
setPop(pastGenlightPopulation) = ~pop
pastGenlightPopulation$pop = factor(pastGenlightPopulation$pop)
levels(pastGenlightPopulation$pop)
pastGenlightPopulation$pop = factor(pastGenlightPopulation$pop,
levels(pastGenlightPopulation$pop)[c(4, 1, 2, 3, 5)])
set.seed(694)
#99 permutations
sefl.fst <- stamppFst(pastGenlightPopulation, nboots = 99, percent = 95, nclusters = 2)
sefl.fst$Fsts
sefl.fst$Pvalues
#Generating heat map of pairwise Fst values
#reordering my samples to stay formatted properly for the matrix, and still have them go north to south
pop.order = c("Pompano/LBTS", "Boynton Beach", "West Palm Beach", "Jupiter", "St. Lucie Reef")
#reads in Fst matrix
snpFstMa <- as.matrix(sefl.fst$Fsts)
#rebuilding the matrix based on order of populations
upperTriangle(snpFstMa, byrow = TRUE) <- lowerTriangle(snpFstMa)
snpFstMa <- snpFstMa[,pop.order] %>% .[pop.order,]
snpFstMa[upper.tri(snpFstMa)] <- NA
snpFstMa <- as.data.frame(snpFstMa)
snpFstMa$Pop = factor(row.names(snpFstMa))
snpQMa <- as.matrix(sefl.fst$Pvalues)
upperTriangle(snpQMa, byrow=TRUE) <- lowerTriangle(snpQMa)
snpQMa <- snpQMa[,pop.order] %>%
.[pop.order,]
snpQMa[upper.tri(snpQMa)] <- NA
snpQMa <- as.data.frame(snpQMa)
snpQMa$Pop = factor(row.names(snpQMa), levels = unique(pop.order))
snpFstMa$Pop = factor(row.names(snpFstMa), levels = unique(pop.order))
snpFst = melt(snpFstMa, id.vars = "Pop", value.name = "Fst", variable.name = "Pop2", na.rm = FALSE)
snpFst$Fst = round(snpFst$Fst, 3)
snpFst = snpFst %>% mutate(Fst = replace(Fst, Fst < 0, 0))
snpQ = melt(snpQMa, id.vars = "Pop", value.name = "Pval", variable.name = "Pop2", na.rm = FALSE)
snpQ$Qval = p.adjust(snpQ$Pval, method = "BH")
snpFst$region = snpFst$Pop
snpFst$region = factor(gsub("\\n.*", "", snpFst$region))
snpFst$region = factor(snpFst$region, levels = levels(snpFst$region)[c(4, 2, 5, 1, 3)])
snpFst$region2 = snpFst$Pop2
snpFst$region2 = factor(gsub("\\n.*", "", snpFst$region2))
snpFst$region2 = factor(snpFst$region2, levels = levels(snpFst$region2)[c(4, 2, 5, 1, 3)])
snpFst$Fst = sprintf('%.3f', snpFst$Fst)
snpFst$Fst = factor(gsub("\\NA", NA, snpFst$Fst))
snpFst$Fst = factor(gsub("\\.000", "", snpFst$Fst))
snpFst$Fst = factor(gsub("\\-", "", snpFst$Fst))
snpHeatmapA = ggplot(data = snpFst, aes(Pop, Pop2, fill = as.numeric(as.character(Fst))))+
geom_tile(color = "white") +
geom_segment(data = snpFst, aes(x = 0.48, xend = -0.62, y = Pop, yend = Pop, color = region), size = 19) +
geom_segment(data = snpFst, aes(x = Pop2, xend = Pop2, y = 0.45, yend = -0.6, color = region2), size = 62.5) +
scale_color_manual(values = flPal[], guide = NULL) +
scale_fill_gradient(low = "white", high = "red", limit = c(0, 0.07), space = "Lab", name = expression(paste(italic("F")[ST])), na.value = "white",  guide = "colourbar")+
geom_text(data = snpFst, aes(Pop, Pop2, label = Fst), color = ifelse(snpQ$Qval <= 0.05,"black", "darkgrey"), size = ifelse(snpQ$Qval < 0.05, 6, 5), fontface = ifelse (snpQ$Qval < 0.05, "bold", "plain")) +
guides(fill = guide_colorbar(barwidth = 12, barheight = 1, title.position = "top", title.hjust = 0.5)) +
scale_y_discrete(position = "left") +
scale_x_discrete(limits = rev(levels(snpFst$Pop))[c(1:5)]) +
coord_cartesian(xlim = c(1, 5), ylim = c(1, 5), clip = "off") +
theme_minimal()
snpHeatmap = snpHeatmapA + theme(
axis.text.x = element_text(vjust = 1, size = 16, hjust = 0.5, color = "black"),
axis.text.y = element_text(size = 16, color = "black"),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
panel.grid.major = element_blank(),
panel.border = element_blank(),
axis.ticks = element_blank(),
legend.position = c(0.5, 0.87),
legend.direction = "horizontal",
legend.title = element_text(size = 16),
legend.text = element_text(size = 14),
plot.title = element_text(size = 16)
)
snpHeatmap
ggsave("C:/Users/erin_/Documents/GitHub/SEFL_Pastreoides_2bRAD/figures/fstHeatMap.png", plot = snpHeatmap, width = 30, height = 9, units = "cm", dpi = 300)
ggsave("C:/Users/erin_/Documents/GitHub/SEFL_Pastreoides_2bRAD/figures/fstHeatMap.eps", plot = snpHeatmap, width = 30, height = 9, units = "cm", dpi = 300)
#packages: magick, cowplot
#choose your colors
#paletteer_d("LaCroixColoR::PeachPear", type = c("discrete"))
#flPal = paletteer_d("LaCroixColoR::PeachPear")[c(1,2,3,4,5)]
#flPal = paletteer_d("LaCroixColoR::paired")[c(11,12,8,4,3)]
#flPal= paletteer_d("LaCroixColoR::paired")[c(2,12,8,4,11)]
#flPal= paletteer_d("LaCroixColoR::paired")[c(2,5,8,4,11)]
#flPal = paletteer_d("RSkittleBrewer::tropical")[c(3,1,5,4,2)]
#flPal = paletteer_d("RSkittleBrewer::smarties")[c(1,3,4,5,6)]
flPal = paletteer_d("LaCroixColoR::PeachPear")[c(1,2,3,4,5)]
latLab = paste(format(abs(seq(26, 27.2, by = 0.2)), nsmall = 1), "ºN", sep = "")
longLab = paste(format(abs(seq(-80.6, -79.2, by = 0.2)), nsmall = 1), "ºW", sep = "")
siteMap = ggplot() +
geom_sf(data = florida, fill = "white", color = "gray40", size = 0.25) +
geom_sf(data = countries, fill = "white", color = "gray40", size = 0.25) +
geom_sf(data = frt, fill = "gray80", size = 0) +
geom_point(data = popLabs, aes(x = longDD, y = latDD, fill = region), shape = 21, size = 4) +
geom_sf_text(data = countyNames, aes(label = ID), nudge_x = c(0.1, 0, 0.1),
nudge_y = c(0, -.025, -0.1)) +
scale_fill_manual(values = flPal, name = "Population:") +
coord_sf(xlim = c(-80.6, -79.2), ylim = c(26, 27.2)) +
scale_x_continuous(breaks = c(seq(-80.6, -79.2, by = 0.2)), labels = longLab) +
scale_y_continuous(breaks = c(seq(26, 27.2, by = 0.2)), labels = latLab) +
annotation_scale(location = "br") +
guides(fill = guide_legend(ncol = 3)) +
theme_bw() +
theme(panel.background = element_rect(fill = "aliceblue"),
panel.border = element_rect(color = "black", size = 0.75, fill = NA),
plot.background = element_blank(),
axis.ticks = element_line(color = "black"),
axis.text = element_text(color = "black"),
axis.title = element_blank(),
legend.background = element_blank(),
legend.title = element_text(size = 10),
legend.text = element_text(size = 10),
legend.key = element_blank(),
legend.position = "bottom",
legend.direction = "horizontal")
#add a picture of P. astreoides
pastPic = image_read("C:/Users/erin_/Documents/GitHub/SEFL_Pastreoides_2bRAD/data_files/past.png") %>%
image_border("black", "10x10")
seflMap = ggdraw() +
draw_plot(siteMap) +
draw_plot(floridaMap, x = 0.63, y = 0.655, width = 0.35, height = 0.35) +
draw_image(pastPic, x = 0.63, y = 0.21, width = 0.336, height = 0.336)
# seflMap
ggsave("C:/Users/erin_/Documents/GitHub/SEFL_Pastreoides_2bRAD/figures/pastMap.png", plot = seflMap, width = 12, height = 13, units = "cm", dpi = 300)
ggsave("C:/Users/erin_/Documents/GitHub/SEFL_Pastreoides_2bRAD/figures/pastMap.tiff", plot = seflMap, width = 12, height = 13, units = "cm", dpi = 300)
ggsave("C:/Users/erin_/Documents/GitHub/SEFL_Pastreoides_2bRAD/figures/pastMap.eps", plot = seflMap, width = 12, height = 13, units = "cm", dpi = 300)
